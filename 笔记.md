#笔记

##PowerCLI

获取GuestID

	[VMware.Vim.VirtualMachineGuestOsIdentifier].GetEnumValues()

新建虚拟机

	New-VM -Name LAB-K8S-NODE02 -VMHost 10.255.240.100 -Description LAB-K8S-NODE02 -Datastore OKSTOR-OFDS1016-FRA-1T -NumCPU 4 -MemoryGB 8 -DiskGB 20 -NetworkName "DPG-240" -Floppy -CD -DiskStorageFormat Thin -GuestID centos7_64Guest
	
	New-VM -Name aaaa-t -VMHost 10.255.240.100 -Description LAB-K8S-NODE02 -Datastore OKSTOR-OFDS1016-FRA-1T -NumCPU 4 -MemoryGB 8 -DiskGB 20 -NetworkName "DPG-240" -Floppy -CD -DiskStorageFormat Thin -GuestID centos7_64Guest

Write-Host '确认要删除虚拟机$full吗？'
Write-output "确认要删除虚拟机$full 吗？"

rm-vm.ps1
####################################################
	$VmName = Read-Host "请输入需要删除的虚拟机的名称"
	$FullVmName = get-vm *$VmName* | foreach{$_.Name} 
	$PowerState = get-vm $FullVmName | Where {$_.PowerState -eq "PoweredOn"} 
	$Choice =  Read-Host "确认要删除名为:$FullVmName 的虚拟机吗？y/n"
	if ($Choice -eq "y")
	{
	  if ($PowerState -eq $null)
	  {
		get-vm $FullVmName |Remove-VM  -DeletePermanently -confirm:$false
	  }
	  else
	  {
		get-vm $FullVmName |stop-vm -confirm:$false |Remove-VM  -DeletePermanently -confirm:$false
	  }
	}
	else
	{
		Write-output "退出"
	}
####################################################


new-vm.ps1
####################################################
$Cluster = Cluster
$NetworkName = DPG-240
$VmName = Read-Host "请输入新建虚拟机的名称"
$NumCPU = Read-Host "请输入新建虚拟机的CPU数量"
$MemoryGB = Read-Host "请输入新建虚拟机的内存大小"
$DiskGB = Read-Host "请输入新建虚拟机的磁盘大小"
Write-Host "新建虚拟机可选择的存储有"
Write-Host "1.XIO-RAID5   2.OKSTOR-OFDS1016-RAID6   3.OKSTOR-OFDS1016-Cache"
$Datastore = Read-Host "请确认您的选择"
switch ($Datastore)
 {
  1 {$Datastore = "XIO-RAID5"}
  2 {$Datastore = "OKSTOR-OFDS1016-RAID6"}
  3 {$Datastore = "OKSTOR-OFDS1016-Cache"}
 }
New-VM -Name $VmName -ResourcePool $Cluster -Description $VmName -Datastore $Datastore -NumCPU $NumCPU -MemoryGB $MemoryGB -DiskGB $DiskGB -NetworkName $NetworkName -Floppy -CD -DiskStorageFormat Thin -GuestID $GuestID
####################################################

new-vm.ps1
####################################################
read -p "请输入新建虚拟机的名称:" VmName
read -p "请输入新建虚拟机所在的主机:" VmHost
read -p "请指定新建虚拟机的CPU、内存、硬盘参数:" NumCPU MemoryGB DiskGB
echo "请选择新建虚拟机所在的存储"
select Datastore in XIO-RAID5 OKSTOR-OFDS1016-RAID6 OKSTOR-OFDS1016-Cache;
do
    break
done
echo "请选择新建虚拟机所在的网络"
select NetworkName in DPG-240 DPG-SPT "VM Network" DPG-220;
do
    break
done

New-VM -Name $VmName -VMHost $VmHost -Description $VmName -Datastore $Datastore -NumCPU $NumCPU -MemoryGB $MemoryGB -DiskGB $DiskGB -NetworkName $NetworkName -Floppy -CD -DiskStorageFormat Thin -GuestID $GuestID
####################################################

常用命令
	get-vm k8s-master?,k8s-node? |stop-vm -confirm:$false
	get-vm k8s-master?,k8s-node? |Remove-VM  -DeletePermanently
	get-vm k8s-master?,k8s-node? |Remove-VM  -DeletePermanently -confirm:$false
	get-vm *rancher* |stop-vm -confirm:$false |Remove-VM  -DeletePermanently -confirm:$false
	get-vm *240.90 |Format-Table -Property name
	get-vm *240.90 |Format-Table -Property PowerState
	get-vm *240.90 |Where {$_.PowerState -eq "PoweredOn"} 
	get-vm *240.90 |Where-Object -FilterScript {$_.PowerState -eq "PoweredOn"}
	get-vm *240.90 |select PowerState
	get-vm *k8s* | Where-Object {$_.PowerState -match "PoweredOff"} |Format-Table -Property name 
	get-vm *240.90 | foreach{$_.Name}
	get-vm *k8s* | foreach{$_.Name} |select -Last 1
	get-vm *k8s* | foreach{$_.Name} |select -Last 2
	Get-Datastore| Where-Object {$_.Name -notmatch "local|datastore|XIO-RAID5"}
	Get-Datastore| Where-Object {$_.Name -match "OKSTOR"}

63350128 蔡老师
##python
### IDE环境搭建

1、安装Sublime Text 3

2、Package Control

	-3.1 安装
	-使用 [Ctrl + \`] (或View > Show Console menu)打开Sublime Text控制台。

	-将下面的Python代码粘贴到控制台里. 根据 sublime 的版本, 对应不同的代码。可以在这里查看

-	https://packagecontrol.io/installation#st3


	import urllib.request,os,hashlib; h = '6f4c264a24d933ce70df5dedcf1dcaee' + 'ebe013ee18cced0ef93d5f746d80ef60'; pf = 'Package Control.sublime-package'; ipp = sublime.installed_packages_path(); urllib.request.install_opener( urllib.request.build_opener( urllib.request.ProxyHandler()) ); by = urllib.request.urlopen( 'http://packagecontrol.io/' + pf.replace(' ', '%20')).read(); dh = hashlib.sha256(by).hexdigest(); print('Error validating download (got %s instead of %s), please try manual install' % (dh, h)) if dh != h else open(os.path.join( ipp, pf), 'wb' ).write(by)


	-确认。如果在Perferences->package settings中看到package control这一项，则表明安装成功。

2.2 如何安装插件: 
-按下Ctrl+Shift+P调出命令面板。
-输入install 调出 Install Package 选项并回车。 
-在列表中选中要安装的插件,或者输入插件名点击即可安装插件。

2.3 查看已安装插件 
-按下Ctrl+Shift+P调出命令面板 
-输入”package”，在下拉列表找到”Package Control: list packages”，选中后回车，全部的插件就会显示出来了。

3、安装SublimeCodeIntel（代码提示插件，可根据语言自动代码提示）
-按下Ctrl+Shift+P调出命令面板，输入install 调出 Install Package选项。输入sublimeCodeIntel,然后选中安装。
-配置: Perference > Package Settings > SublimeCodeIntel > Settings-Default （SublimeCodeIntel.sublime-settings）
找到python3设置,改成我这样。

    "codeintel_language_settings": {
        "Python3": {
            "python3": "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/python.exe",
            "codeintel_scan_extra_dir": [
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/DLLs",
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/Lib",
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/Lib/site-packages",
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/Lib/idlelib",
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/",
                "C:/Users/CHUN/AppData/Local/Programs/Python/Python36/Lib/*",
            ],
            "codeintel_scan_files_in_project": true,
            "codeintel_selected_catalogs": []
        },


4、安装SublimeREPL插件

-按下Ctrl+Shift+P调出命令面板，输入install 调出 Install Package选项，输入SublimeREPL,然后选中安装。

-设置快捷键
-打开 preferences>key bindings （Default (Windows).sublime-keymap）

	[
	{
	"keys":["f5"],  
	"caption": "SublimeREPL: Python - RUN current file",  
	"command": "run_existing_window_command", 
	"args": 
	{"id": "repl_python_run",  
	"file": "config/Python/Main.sublime-menu"
	}
	} 
	]

-5、安装python3编译环境
-打开 Tools > Build System > New Build System 
-输入以下内容

	{
		"cmd": "C:/Users/synet/AppData/Local/Programs/Python/Python36/python.exe -u \"$file\"",  
		"file_regex": "^[ ]*File \"(...*?)\", line ([0-9]*)",  
		"selector": "source.python",
		"encoding": "cp936"
	}

-Ctrl + S 直接保存为想要命名的编译名称（RunPython36.sublime-build），重启 Sublime text 3，打开 Tools > Build System选择 RunPython36即可。

-按ctrl +b 是执行操作的命令，切记，切记，切记执行前要先保存文件。



##常用命令
##Linux常用命令
mkdir -p ./sub/{1/{11,12,13},2/{21,22,23},3/{31,32,33}}

- 查看所有已启动的服务

	systemctl list-units --type=service

不显示#开头的行

	egrep -v "^#"  /etc/vsftpd/vsftpd.conf

命令历史不显示行号

	history |awk '{$1=""; print $0}'




##Docker

-	安装

		vi /etc/sysconfig/network-scripts/ifcfg-eth0 
		hostnamectl --static set-hostname lab-rancherv2
		reboot

		yum install -y yum-utils  device-mapper-persistent-data  lvm2
		yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
		yum makecache fast
		yum list docker-ce.x86_64  --showduplicates | sort -r
		yum install -y --setopt=obsoletes=0 docker-ce-17.03.2.ce-1.el7.centos docker-ce-selinux-17.03.2.ce-1.el7.centos
		systemctl enable docker && systemctl restart docker

		cat <<EOF > /etc/yum.repos.d/kubernetes.repo
		[kubernetes]
		name=Kubernetes
		baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
		enabled=1
		gpgcheck=1
		repo_gpgcheck=1
		gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
		EOF

		yum makecache fast
		cat /etc/sysconfig/selinux
		docker search rancher
		docker search rancher/rancher
		docker run -d --restart=unless-stopped -p 80:80 -p 443:443 rancher/rancher

		docker rm 3e0ac7ea68c9

		docker ps -a
		https://10.255.240.70
		admin/synet.com1

		yum -y update
		tee /etc/yum.repos.d/docker.repo <<-'EOF'
		[dockerrepo]
		name=Docker Repository
		baseurl=https://yum.dockerproject.org/repo/main/centos/7/
		enabled=1
		gpgcheck=1
		gpgkey=https://yum.dockerproject.org/gpg
		EOF
		systemctl enable docker.service
		systemctl start docker.service
		vi /usr/lib/systemd/system/docker.service
		ExecStart=/usr/bin/dockerd-current \
		          --registry-mirror=https://h42tqd61.mirror.aliyuncs.com \
		docker run -d -p 80:8080 --name portal  --restart=always -v /synet/wwwroot:/usr/local/tomcat/webapps -v /synet/logs:/usr/local/tomcat/logs tomcat
		
		docker run -d -p 80:8080 --name portal  --restart=always -v /synet/wwwroot:/usr/local/tomcat/webapps  tomcat
		docker exec -it portal-https /bin/bash
		docker logs -f portal-https
		docker logs -f --tail 300 portal-https
		Remove-VM VM -DeletePermanently



###K8S


###PowerCLI

-1、打开WindowsPowerShell

	Find-Module -Name VMware.PowerCLI
	mkdir  ~\Documents\WindowsPowerShell\Modules

-2、下载PowerCLI

	Save-Module -Name VMware.PowerCLI -Path ~\Documents\WindowsPowerShell\Modules\


-3、安装

	Install-Module -Name VMware.PowerCLI
	提示“因为在此系统上禁止运行脚本”
	Set-ExecutionPolicy RemoteSigned
	
	Set-PowerCLIConfiguration -Scope User -ParticipateInCEIP $true
	Import-Module VMware.PowerCLI

-4、快捷键

	C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noe -c "Import-Module VMware.PowerCLI"

###PowerCLI for linux

-1、安装 powershell
	 #配置yum源
	 curl https://packages.microsoft.com/config/rhel/7/prod.repo > /etc/yum.repos.d/microsoft.repo 
	 yum install powershell

-2、安装VMware.PowerCLI 模块

	#运行powershell
	pwsh
	Save-Module -Name VMware.PowerCLI -Path ~/.local/share/powershell/Modules/
	Install-Module -Name VMware.PowerCLI

-3、

##YUM服务器
-1、安装虚拟机及CentOS7

通过powercli新建虚拟机

	New-VM -Name SPT-YUM -VMHost 10.255.240.101 -Description yum -Datastore OKSTOR-OFDS1016-Cache -NumCPU 2 -MemoryGB 4 -DiskGB 20 -NetworkName "DPG-240" -Floppy -CD -DiskStorageFormat Thin -GuestID centos7_64Guest
    
    start-vm SPT-YUM

系统配置
    系统升级
    yum -y update

    更改IP

    更改主机名
    hostnamectl --static set-hostname

安装Docker
		yum install -y yum-utils  device-mapper-persistent-data  lvm2
		yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
		yum makecache fast
		yum install -y docker-ce.x86_64
		systemctl enable docker && systemctl restart docker



docker run \
  --name nginx-yum \
  -d -p 80:80 \
  -v /usr/docker/nginx/html:/usr/share/nginx/html \
  nginx

##用户名/密码
	vCenter:
	vplatform.heikuai.com
	https://vcenter.heikuai.com
	heikuai.com\administrator
	ESX1@Synet
	
	阿里云
	IP:47.93.228.226
	root/Synet.com2017
	
	虚拟机监控
	https://10.255.247.252
	admin\ Synet@com1
	
	网络及AP监控
	
	ACS
	https://10.255.247.249/acsadmin/
	admin\ Synet.com2
	acsadmin\ Synet.com2

	86629100
	
	kaifa/sykf.com1
	
	龙果学院 
	13320332356/Synet1com
	
	CSDN
	faqcn/Synet1com
	faqcn@163.com/Synet1com
	
	缓存服务器
	admin/Synet.com2017

	任天行网络安全管理系统
	https://10.255.240.238/manage/index/login
	admin/admin*PWDgdjt
	
	华为服务器
	10.255.240.201\202\203\204
	root/Huawei12#$
	
	ESXi6:
	10.255.240.101\102\103\104
	root/esx1.Server
	
	10.154.55.5\6\7
	root/ESX.Server
	
	root/WiFi0Admin@9
	
	round-robin
	active-standby
	
	ruijie
	ruijie@shangyuN18K
	EnablePassw0rd
	
	VPN用户：
	113.204.21.170
	synet
	syvpn 
	vpn@sy,123
	
	两路口
	外网登录地址：
	113.204.21.170
	10.1.2.14
	https://113.204.21.170:4443
	hillstone
	sy@FW.e5560
	
	
	服务器横向
	10.1.4.14
	
	sy@FW.m6560
	
	办公出口
	外网登录地址：
	113.204.168.94
	
	m2600 密码：
	sy@FW.m2600
	FW-2(M)# show ipsec sa 
	FW-2(M)# clear ipsec sa
	
	1045167618
	chun.com.www.



##docker+jenkins+git+registry
-1、服务器规划

registry服务器 	harbor	10.255.247.220；221		vmware harbor

git服务器		git 	10.255.247.247			安装docker、git服务

docker服务器		docker 	10.255.247. 			安装docker、创建镜像运行java项目：tale

jenkins服务器	jenkins 10.255.247.223，224	 	安装docker、 运行jenkins容器、git客户端、jdk、maven

-2、安装registry服务器——harbor
